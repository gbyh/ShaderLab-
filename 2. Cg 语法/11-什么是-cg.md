##什么是 Cg

&emsp;&emsp;本书将教你如何使用一种叫 Cg 的编程语言。Cg 语言使得控制使用可编程图形硬件画的物体的形状、外观和运动成为了可能。它把这些属性的可编程控制和当今难以置信的高速度和高性能图形处理器很好的结合在一起。在此之前从来没有计算机图形从业者，无论是美工人员还是程序员，在他们生成自己的实时图像的时候有如此多的控制能力。

&emsp;&emsp;Cg 为开发人员提供了一整套使用方便的编程平台，使得迅速生成特殊的效果和在多种平台上体验实时电影效果成为可能。通过提供一个新的抽象层，Cg 使开发人员不需要再直接使用图形硬件汇编语言，因此非常适合 OpenGL、DirectX、Windwos、Linux、Macintosh OS X 和游戏平台，例如 Xbox。Cg 是在和 Microsoft 公司密切合作的情况下开发的，因此 Cg 与 OpenGL API 和 Microsoft 的 DirectX9.0 高级光照语言完全兼容。 

&emsp;&emsp;Cg 代表 “用于图形的 C 语言” （C for graphics）。C 语言是一种非常流行的、开发于 20 世纪 70 年代的通用编程语言。因为它的流行和简洁的设计，C 语言为后续的几种编程语言提供了坚实的基础。例如，C++ 和 Java 的语法和结构都是基于 C 的。Cg 语言本身也是基于 C 语言的。如果你熟悉 C 语言或者是从 C 语言派生出来的其他语言，Cg 将会非常容易掌握。

&emsp;&emsp;另一方面，如果你不熟悉 C 语言，或者甚至没接触过一般的编程语言，但是你非常喜欢计算机图形并且想学一些新东西，无论如何都请继续阅读本书。Cg 程序都非常短小和易于理解。

&emsp;&emsp;本章的大部分都在讲述背景知识，将为你理解 Cg 和有效地使用 Cg 提供有价值的上下文关系。另一方面，你将发现通过实践 Cg 是非常容易学习的。如果你想马上进入 Cg 教程，那么可以随时直接跳到第 2 章去。

---

####1.1.1 为可编程图形硬件设计的语言

&emsp;&emsp;Cg 不同于 C、C++ 和 Java，因为它非常特别。没有人会用 Cg 写电子制表软件或者文字处理应用程序。相反，**Cg 的目标是为使用图形硬件渲染的物体的形状、外观和运动提供可编程控制的能力。**从广义上讲，这种类型的语言被称为光照语言。但是，Cg 可以做光照以外的很多事情。例如，Cg 程序可以实现物理模拟、混合和其他非光照任务。

&emsp;&emsp;你可以把 Cg 看作是一个非常详细的通过使用可编程图形硬件渲染物体的 “处方”。例如，你可以编写一个 Cg 程序来使物体的外表看起来非常凹凸不平，或者使一个虚拟的人物运动起来。以后，在第 1.3 节中，你将学习许多光照语言的历史和 Cg 是如何融入这个历史中的。

---

####1.1.2 Cg 的数据流模型

&emsp;&emsp;除了专门为图形设计以外，Cg 和其他光照语言与传统的编程语言是不同的，因为它们是基于数据流模型的。在这样一个模型里，计算的发生是为了响应流经一序列处理过程的数据。

&emsp;&emsp;Cg 程序运行在渲染一幅图像时被处理的顶点和片段上（如果你不知道什么是片段，现在就把它当作像素）。你可以把 Cg 程序想象成一个黑箱，顶点和片段从一边流入，经过某些变换后，从另一边流出。但是，这个箱子并不是一个真正的黑箱，因为你可以通过编写 Cg 程序来决定它到底起什么作用。

&emsp;&emsp;在渲染三维场景的时候，每当一个顶点被处理或者光栅器产生一个片段，你对应的顶点或者片段 Cg 程序就会被执行。第 1.3 节会进一步解释 Cg 的数据流模型。

&emsp;&emsp;大部分最新的个人计算机和所有最近的游戏平台都包括一个图形处理器（GPU），来专门处理图形任务，例如变换和光栅化三维模型。你的 Cg 程序实际上是在你计算机中的图形处理器上执行的。

---

####1.1.3 图形处理器的特殊性和中央处理器的通用性

&emsp;&emsp;无论是个人计算机或者游戏平台是否拥有一个图形处理器，它都必须有一个中央处理器来运行操作系统和应用程序。中央处理器是以多种用途为目的设计的。中央处理器所执行的程序（例如，文字处理器和统计软件包）是用多用途的语言编写的，例如 C++ 或者 Java。

&emsp;&emsp;因为图形处理器是专门设计的，它执行图形任务要比多用途的中央处理器快许多，例如渲染三维场景。新的图形处理器可以在一秒钟内处理好几千万的顶点和光栅化几亿或者甚至是几十亿片段。未来的图形处理器会更快。这绝对比中央处理器处理类似数量的顶点和片段的速度快许多。但是，图形处理器不能像中央处理器那样运行任意的多种多样的程序。

&emsp;&emsp;图形处理器的这种专用性和高性能是 Cg 为什么存在的原因。多用途的编程语言对处理顶点和片段这项专门的任务来说太自由了。相反，Cg 语言是专用于这项任务的。Cg 同样也提供了一个和图形处理器的执行模型相符合的抽象执行模型。你将在第 1.2 小节学习图形处理器独特的执行模型。

---

####1.1.4 Cg 性能的基本原理

&emsp;&emsp;为了支持想象的交互性，一个三维应用程序需要维护每秒显示 15 帧或更多图像的刷新率。通常，我们认为 60 帧／s 或更高的刷新率为实时，在这样的刷新率下与应用程序的交互看起来就像同时发生的。计算机的显示屏幕也许有 100 万或更多的像素需要重画。对一个三维场景而言，图形处理器一般对屏幕上的一个像素需要处理好几次，因为场景中的物体总是相互重叠的，或者是为了提高每个像素的表现。这就意味着实时三维应用程序每秒钟需要更新几亿个像素。随同需要处理的像素是由顶点组成的三维模型，这些顶点在被正确地变换之后，才能被组成多边形、线段和点，然后光栅化成像素。这就需要每秒钟变换上千万的顶点。

&emsp;&emsp;而且，在这种图形处理之外还需要中央处理器相当大的工作来为每个新图像更新显示。事实上，我们同时需要中央处理器和图形处理器专门面向图形的功能。以一个可交互的刷新率和三维应用程序和游戏所要求的质量标准来渲染场景同时需要这两种处理器。这意味着一个开发人员可以用 C++  写一个三维应用程序或游戏，然后使用 Cg 来充分利用图形处理器的额外的图形处理能力。


---

####1.1.5 与传统编程语言共存

&emsp;&emsp;Cg 绝不是用来代替现存的多用途编程语言。Cg 是一种辅助语言，是专门为图形处理器设计的。使用 C 或者 C++ 等传统编程语言为中央处理器编写的程序可以使用 Cg 的运行程序（将会在第 1.4.2 小节进行解释）来加载在图形处理器上执行的 Cg 程序。Cg runtime（Cg 运行库）是一个用来加载、编译、操作和设置 Cg 程序在图形处理器上执行的标准子程序集合。应用程序使用 Cg 程序来指示图形处理器如何完成这些可编程的渲染效果，这些效果在中央处理器上不可能达到图形处理器所能获得的渲染速度。

&emsp;&emsp;Cg 使得一种专门类型的并行处理成为可能。当你的中央处理器执行一个传统的应用程序的时候，这个应用程序将通过 Cg 编写的程序来协调图形处理器对顶点和片段进行并行处理。如果一个实时光照语言是这样好的一个主意的话，为什么没有人早一点发明 Cg 呢？这个问题的答案与计算机硬件的发展有关。在 2001 年以前，大部分计算机图形硬件，当然是那种不是很昂贵的用于个人计算机和游戏控制台的图形硬件，采用硬件连线方式实现顶点和片段的处理任务。**硬件连线方式是指这些算法是固定在硬件里的**，与可以被








🔚